<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.alltoons.root.webtoon.mapper.WebtoonPageMapper">
	<resultMap
		type="com.alltoons.root.webtoon.dto.WebtoonCategoryDTO" id="category">
		<result property="webtoonNum" column="webtoon_num" />
		<result property="webtoonTitle" column="webtoon_title" />
		<result property="webtoonWriter" column="webtoon_writer" />
		<result property="webtoonImage" column="webtoon_image" />
		<result property="webtoonGenre" column="webtoon_genre" />
		<result property="webtoonGenreKor" column="genre_kor" />
		<result property="platformName" column="WEBTOON_PLATFORM_NAME" />
		<result property="platformNameKor" column="kor" />
		<result property="platformNum" column="p_num" />
	</resultMap>
	<resultMap
		type="com.alltoons.root.webtoon.dto.WebtoonCategoryDTO" id="category2">
		<result property="webtoonNum" column="webtoon_num" />
		<result property="webtoonTitle" column="webtoon_title" />
		<result property="webtoonWriter" column="webtoon_writer" />
		<result property="webtoonImage" column="webtoon_image" />
		<result property="webtoonGenre" column="webtoon_genre" />
				<result property="webtoonGenreKor" column="genre_kor" />
		<result property="platformName" column="WEBTOON_PLATFORM_NAME" />
		<result property="platformNameKor" column="kor" />
		<result property="platformNum" column="count" />
	</resultMap>
	
	<select id="platformView" resultMap="category">
		select * from(
		select
		webtoon_info.webtoon_num, webtoon_info.webtoon_title,
		webtoon_info.webtoon_writer, webtoon_info.webtoon_image,
		PLATFORM_TABLE.WEBTOON_PLATFORM_NAME,KOR_PLATFORM.kor,rownum as num
		from
		PLATFORM_TABLE,webtoon_info,KOR_PLATFORM
		where
		PLATFORM_TABLE.WEBTOON_PLATFORM_NAME = #{platformName} 
		and
		PLATFORM_TABLE.webtoon_num = webtoon_info.webtoon_num
		and
		KOR_PLATFORM.eng = PLATFORM_TABLE.WEBTOON_PLATFORM_NAME
		order by
		webtoon_info.webtoon_title asc
		)
		<![CDATA[WHERE ROWNUM <= 15]]>
	</select>
	
	<!-- 제목 정렬 -->
	<select id="sortNameAjax" resultMap="category">
		select * 
		from(
			select
				webtoon_info.webtoon_num, webtoon_info.webtoon_title,
				webtoon_info.webtoon_writer, webtoon_info.webtoon_image,
				PLATFORM_TABLE.WEBTOON_PLATFORM_NAME,KOR_PLATFORM.kor,rownum as num
			from
				PLATFORM_TABLE,webtoon_info,KOR_PLATFORM
			where
				PLATFORM_TABLE.WEBTOON_PLATFORM_NAME = #{platformName} 
			and
				PLATFORM_TABLE.webtoon_num = webtoon_info.webtoon_num
			and
				KOR_PLATFORM.eng = PLATFORM_TABLE.WEBTOON_PLATFORM_NAME
			<if test="sort.equals('nameAsc') ">
			 	order by webtoon_info.webtoon_title asc
			</if>
			<if test="sort.equals('nameDesc')">
				order by webtoon_info.webtoon_title desc
			</if>
			<if test="sort.equals('viewCount')">
				order by webtoon_info.webtoon_hit desc , webtoon_info.webtoon_title asc
			</if>
			
		)<![CDATA[WHERE num between #{start} and #{limit}]]>
			
	</select>
	
	<!-- 플랫폼별 인기순 정렬 -->
	<select id="platformPopularPage" resultMap="category2">
		select * from(
		select DISTINCT
		webtoon_info.webtoon_num, webtoon_info.webtoon_title, webtoon_info.webtoon_writer,
		webtoon_info.webtoon_image,(
			select count(favorites) 
			from FAVORITES_INFO 
			where FAVORITES_INFO.webtoon_num =PLATFORM_TABLE.WEBTOON_NUM 
			and FAVORITES_INFO.favorites = 'T')as count,
			KOR_PLATFORM.kor,rownum as num
		from webtoon_info, FAVORITES_INFO,PLATFORM_TABLE,KOR_PLATFORM
		where webtoon_info.webtoon_num =PLATFORM_TABLE.WEBTOON_NUM
		and  PLATFORM_TABLE.WEBTOON_PLATFORM_NAME = #{platformName}
		and KOR_PLATFORM.eng = WEBTOON_PLATFORM_NAME
		order by count desc, webtoon_info.webtoon_title asc
		)
		<![CDATA[WHERE num between #{start} and #{limit}]]>
	</select>
	
</mapper>